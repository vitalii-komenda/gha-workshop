name: Github Action Workflow

on: [push]

env:
    SESSION_NAME: "GHA workshop"
    PARTICIPANT_COUNT: "5"

jobs:
    test:
        runs-on: ubuntu-latest
        services:
            postgres:
                image: postgres:15-alpine
                env:
                    POSTGRES_USER: postgres
                    POSTGRES_PASSWORD: keyboardcat
                    POSTGRES_DB: tasks
                options: >-
                    --health-cmd pg_isready
                    --health-interval 3s
                    --health-timeout 15s
                    --health-retries 5
                ports:
                    - 5432:5432
        steps:
          - uses: "actions/checkout@v3"
          - name: Setup python
            uses: "actions/setup-python@v4"
            with:
                python-version: "3.11"
          - name: Install deps
            run: |
                python -m pip install --upgrade pip
                pip install -r requirements.txt
          - name: Run tests
            run: |
                python -m unittest discover -s tests -p 'test_*.py'